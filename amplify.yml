# version: 1
# frontend:
#   phases:
#     preBuild:
#       commands:
#         - npm install -f
#     build:
#       commands:
#         - npm run build
#   artifacts:
#     baseDirectory: dist/xped8
#     files:
#       - '**/*'
#   customHeaders:
#     - pattern: '**/*'
#       headers:
#         - key: 'Cache-Control'
#           value: 'max-age=31536000'
#   customRules:
#     - pattern: 'assets/**/*'
#       headers:
#         - key: 'Cache-Control'
#           value: 'max-age=31536000'
#       status: 200
#     - pattern: '**/*'
#       target: '/index.html'
#       status: 200

version: 1
frontend:
  phases:
    preBuild:
      commands:
        # Install dependencies with legacy peer deps
        - npm install --legacy-peer-deps
        # Install Angular CLI globally if needed
        - npm install -g @angular/cli
    build:
      commands:
        # Use npx to ensure ng command is available
        - npx ng build --configuration production
  artifacts:
    baseDirectory: dist/xped8
    files:
      - '*/'
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
  customHeaders:
    - pattern: '**/*'
      headers:
        - key: 'Cache-Control'
          value: 'max-age=31536000'
  customRules:
    - pattern: 'assets/**/*'
      headers:
        - key: 'Cache-Control'
          value: 'max-age=31536000'
      status: 200
    - pattern: '**/*'
      target: '/index.html'
      status: 200
